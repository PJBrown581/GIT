<?xml version="1.0" encoding="utf-8"?>
<AxClass xmlns:i="http://www.w3.org/2001/XMLSchema-instance">
	<Name>SKS_EFT_Format_US_WF_PM_3266</Name>
	<SourceCode>
		<Declaration><![CDATA[
/// <summary>
/// SKS_EFT_Format_US_WF_PM_3266 extends SKS_EFT_Format
/// </summary>
class SKS_EFT_Format_US_WF_PM_3266 extends SKS_EFT_Format
{
    #define.FormatVersion('20220614')
    int mPaymentCount;
    AmountMST mPaymentAmount;

    SKS_EFT_FileDetail prevSKS_EFT_FileDetail;

    #define.ACHCCD('ACH-CCD')
    #define.WIRE_IWI('WIRE-IWI')
    #define.WIRE_MTS('WIRE-MTS')

}
]]></Declaration>
		<Methods>
			<Method>
				<Name>getFormatVersion</Name>
				<Source><![CDATA[
    protected str getFormatVersion()
    {
        return #FormatVersion;
    }

]]></Source>
			</Method>
			<Method>
				<Name>formatStructure</Name>
				<Source><![CDATA[
    [SuppressBPWarningAttribute("BPCheckNestedLoopinCode","Necessary to allow the processing of every invoice(inner loop) for every relevant parent file detail record(outer loop)")]
    protected void formatStructure()
    {
        SKS_EFT_FileDetail  invSKS_EFT_FileDetail;

        // Header Record
        this.rec_Header();
    
        while(mSKS_EFT_FileDetail)
        {
            // Get SKS_EFT_FileFormatPaymSpec
            this.getSKS_EFT_FileFormatPaymSpec();

            //Get remitance Address
            this.getRemittanceAddress(false);
    
            // Detail lines
            this.rec_Payment();
    
            while select invSKS_EFT_FileDetail where invSKS_EFT_FileDetail.RecordSummaryRecId == mSKS_EFT_FileDetail.RecId
            {
                //  Invoice Record
                this.rec_Invoice(invSKS_EFT_FileDetail);
            }
            next mSKS_EFT_FileDetail;
        }
    
        // Format trailer
        this.rec_Trailer();
    }

]]></Source>
			</Method>
			<Method>
				<Name>getRemittanceAddress</Name>
				<Source><![CDATA[
    void getRemittanceAddress(boolean UseCheckNum)
    {
        //Populate Remittance Information from Vendor eBanking details
        mRemittanceName = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneName);
        mRemittanceAdrLine1 = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneAddr);
        mRemittanceAdrLine2 = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneAddr2);
        mRemittanceCity = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneCity);
        mRemittanceState = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneState);
        mRemittanceZipCode = this.CharacterReplacement(mSKS_EFT_FileDetail_VendAddress.BeneZipPostal);
        mRemittanceCountryRegionId = this.getLogisticsAddressCountryISO(mSKS_EFT_FileDetail_VendAddress.BeneCountryRegionId);
    }

]]></Source>
			</Method>
			<Method>
				<Name>rec_Header</Name>
				<Source><![CDATA[
    //Nbr   Description                                       Max     Start   Type 
    //1     Record ID                                          1       1       AN
    //2     File control number                                15      2       AN
    //3     File Date                                          10      17      DT
    //4     End of record                                      2       27      AN
    protected void rec_Header()
    {
        //BP Deviation Documented
        System.Text.StringBuilder sb = new System.Text.StringBuilder();
        ;
    
        busDate = SKS_PP_StringFormats::strDateYYYYMMDD(DateTimeUtil::getToday(DateTimeUtil::getUserPreferredTimeZone()), DateSeparator::Hyphen);

        //1     Record ID                                          1       1       AN
        sb.Append('H');

        //2     File control number                                15      2       AN
        sb.Append(SKS_PP_StringFormats::strFill(15, mSKS_EFT_File.FileNbr, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //3     File Date                                          10      17      DT
        sb.Append(busDate);

        //4     End of record                                      2       27      AN
        sb.Append('HH');
    
        this.fileWrite(sb.ToString());
    }

]]></Source>
			</Method>
			<Method>
				<Name>rec_Payment</Name>
				<Source><![CDATA[
    protected void rec_Payment()
    {
        //BP Deviation Documented
        System.Text.StringBuilder sb = new System.Text.StringBuilder();
        str name;
        int len;
        AmountMST amt;
        ;

        mPaymentCount ++;
        // 1 Record ID
        sb.Append('P');

        //2     Payment method                                      3       2       AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #ACHCCD:
                sb.Append('DAC');
                break;
            case #WIRE_MTS:
                sb.Append('MTS');
                break;
            case #WIRE_IWI:
                sb.Append('IWI');
                break;
        }

        //3     Credit/debit flag                                   1       5       AN
        sb.Append('C');

        //4     Transaction number                                  15      6       AN
        sb.Append(SKS_PP_StringFormats::strFill(15, this.CharacterReplacement(mSKS_EFT_FileDetail.PaymentReference), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //5     Value date/ effective date                          10      21      DT
        sb.Append(SKS_PP_StringFormats::strDateYYYYMMDD(mSKS_EFT_FileDetail.EffectiveDate, DateSeparator::Hyphen));

        //6     Payment amount                                      18      31      N
        amt = this.getPositiveAmount(mSKS_EFT_FileDetail.InvoiceSettleAmountPmtCur);
        sb.Append(SKS_PP_StringFormats::strFill(18, num2str(amt,0,2,0,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
        mPaymentAmount += amt;

        //7     Currency                                            3       49      AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode != #ACHCCD)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3, mSKS_EFT_FileDetail.PaymentCurrencyCode, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //8     FX contract number                                  6       52      AN
        sb.Append(SKS_PP_StringFormats::strFill(6, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //9     Originating party name                              60      58      AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #ACHCCD:
            case #WIRE_MTS:
            case #WIRE_IWI:
                name = subStr(CompanyInfo::find().Name(), 1, 35);
                break;
        }            
        sb.Append(SKS_PP_StringFormats::strFill(60, this.CharacterReplacement(name), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        
        //10    Originating party additional name                   60      118     AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //11    Originating party ID                                15      178     AN
        sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
    
        //12    Originating party address 1                         55      193     AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //13     Originating party address 2                        55      248     AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //14    Originating party city                              30      303     AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //15  Originating party state / province                    3       333     AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //16  Originating party postal code                         9       336     AN
        sb.Append(SKS_PP_StringFormats::strFill(9, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //17  Originating party country code                        2       345     AN
        sb.Append(SKS_PP_StringFormats::strFill(2, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //18  Originating party country name                        30      347     AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //19  Originating bank name                                 60      377     AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //20  Originating bank address                              55      437     AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //21  Originating bank city                                 30      492     AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //22  Originating bank state / province                     3       522     AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //23  Originating bank postal code                          9       525     AN
        sb.Append(SKS_PP_StringFormats::strFill(9, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //24  Originating bank country code                         2       534     AN
        sb.Append(SKS_PP_StringFormats::strFill(2, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //25  Originating account type                              1       536     AN
        if(mSKS_EFT_FileDetail.BankAcctType == BankAccountType::CheckingAccount)
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'D', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'G', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        //26  Originating account                                   34       537     AN*
        sb.Append(SKS_PP_StringFormats::strFill(34, mSKS_EFT_FileDetail.BankBankAcct, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //27  Originating account currency                          3        571     AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //28  Originating bank ID type                              3        574     AN
        //29  Originating bank ID                                   11       577     AN
        if(mSKS_EFT_FileDetail.BankBankTransit)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3, 'ABA', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11, mSKS_EFT_FileDetail.BankBankTransit, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else if(mSKS_EFT_FileDetail.BankBankSwiftNo)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3, 'SWT', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11, mSKS_EFT_FileDetail.BankBankSwiftNo, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        //30  Receiving party name                                  60*     588     AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #ACHCCD:
                name = subStr(mRemittanceName, 1, 22);
                break;
            case #WIRE_IWI:
                name = subStr(mRemittanceName, 1, 35);
                break;
            default:
                name = subStr(mRemittanceName, 1, 60);
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(60, name, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //31  Receiving party additional name                       60*     648     AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //32  Receiving party ID                                    15*     708     AN
        sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //33  Receiving party address 1                             55*     723     AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_IWI:
            case #WIRE_MTS:
                len = 35;
                break;
            default:
                len = 55;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(55, subStr(mRemittanceAdrLine1, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //34  Receiving party address 2                             55*     778     AN
        sb.Append(SKS_PP_StringFormats::strFill(55, subStr(mRemittanceAdrLine2, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_IWI:
            case #WIRE_MTS:
                len = 25;
                break;
            default:
                len = 30;
                break;
        }
        //35  Receiving party city                                  30*     833     AN
        sb.Append(SKS_PP_StringFormats::strFill(30, subStr(mRemittanceCity, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //36  Receiving party state / province                      3       863     AN
        sb.Append(SKS_PP_StringFormats::strFill(3, mRemittanceState, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //37  Receiving party postal code                           9*      866     AN
        sb.Append(SKS_PP_StringFormats::strFill(9, mRemittanceZipCode, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //38  Receiving party country code                          2       875     AN
        sb.Append(SKS_PP_StringFormats::strFill(2, mRemittanceCountryRegionId, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //39  Receiving party country name                          30      877     AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //40  Receiving bank name                                   60      907     AN
        sb.Append(SKS_PP_StringFormats::strFill(60, substr(mSKS_EFT_FileDetail_BenBank.BenBankName, 1, 35), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        
        //41  Receiving bank address                                55*     967     AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_MTS:
            case #WIRE_IWI:
                len = 35;
                break;
            default:
                len = 55;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(55, substr(mSKS_EFT_FileDetail_BenBank.BenBankAddr, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //42  Receiving bank city                                   30*     1022    AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_MTS:
            case #WIRE_IWI:
                len = 25;
                break;
            default:
                len = 30;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(30, substr(mSKS_EFT_FileDetail_BenBank.BenBankCity, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //43  Receiving bank state / province                       3       1052    AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //44  Receiving bank postal code                            9       1055    AN
        sb.Append(SKS_PP_StringFormats::strFill(9, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //45  Receiving bank country code                           2       1064    AN
        sb.Append(SKS_PP_StringFormats::strFill(2, this.getLogisticsAddressCountryISO(mSKS_EFT_FileDetail_BenBank.BenBankCountryRegionId), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //46  Receiving party account type                          1       1066    AN
        if(mSKS_EFT_FileDetail.DepBankAcctType == BankAccountType::CheckingAccount)
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'D', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else if(mSKS_EFT_FileDetail.DepBankAcctType == BankAccountType::FinancialInstitutionAccount)
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'G', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else if(mSKS_EFT_FileDetail.DepBankAcctType == BankAccountType::SavingsAccount)
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'S', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(1, 'C', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        
        //47  Receiving party account                               35*     1067    AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_MTS:
            case #WIRE_IWI:
                len = 34;
                break;
            case #ACHCCD:
                len = 17;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(35, subStr(mSKS_EFT_FileDetail.DepBankAcct,1 , len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //48  Receiving account currency                            3       1102    AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #WIRE_IWI)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3,mSKS_EFT_FileDetail.PaymentCurrencyCode, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //49  Receiving bank primary ID type                        3       1105    AN
        //50  Receiving bank primary ID                             11      1108    AN
        if(mSKS_EFT_FileDetail.DepBankTransit)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3,'ABA', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11,mSKS_EFT_FileDetail.DepBankTransit, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else if(mSKS_EFT_FileDetail.DepSwiftNo)
        {
            sb.Append(SKS_PP_StringFormats::strFill(3,'SWT', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11,mSKS_EFT_FileDetail.DepSwiftNo, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            sb.Append(SKS_PP_StringFormats::strFill(11, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        //51  Receiving bank secondary ID                           34      1119    AN
        sb.Append(SKS_PP_StringFormats::strFill(34,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //52  Intermediary bank name                                35      1153    AN
        sb.Append(SKS_PP_StringFormats::strFill(35,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //53  Intermediary bank address                             35      1188    AN
        sb.Append(SKS_PP_StringFormats::strFill(35,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //54  Intermediary bank city                                25      1223    AN
        sb.Append(SKS_PP_StringFormats::strFill(25,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //55  Intermediary bank state / province                    3       1248    AN
        sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //56  Intermediary bank postal code                         9       1251    AN
        sb.Append(SKS_PP_StringFormats::strFill(9,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //57  Intermediary bank country code                        2       1260    AN
        sb.Append(SKS_PP_StringFormats::strFill(2,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
            
        //58  Intermediary bank ID type                             3       1262    AN
        sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //59  Intermediary bank ID                                  11      1265    AN
        sb.Append(SKS_PP_StringFormats::strFill(11,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //60  Second intermediary bank name                         35      1276    AN
        sb.Append(SKS_PP_StringFormats::strFill(35,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //61  Second intermediary bank address                      35      1311    AN
        sb.Append(SKS_PP_StringFormats::strFill(35,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //62  Second intermediary bank city                         25      1346    AN
        sb.Append(SKS_PP_StringFormats::strFill(25,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //63  Second intermediary bank state / province             3       1371    AN
        sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //64  Second intermediary bank postal code                  9       1374    AN
        sb.Append(SKS_PP_StringFormats::strFill(9,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //65  Second intermediary bank country                      2       1383    AN
        sb.Append(SKS_PP_StringFormats::strFill(2,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        
        //66  Second intermediary bank ID type                      3       1385    AN
        sb.Append(SKS_PP_StringFormats::strFill(3,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        
        //67  Second intermediary bank ID                           11      1388    AN
        sb.Append(SKS_PP_StringFormats::strFill(11,'', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //68  Ordering party name                                   60*     1399    AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_MTS:
            case #WIRE_IWI:
                len = 35;
                break;
            default:
                len = 60;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(60,subStr(mSKS_EFT_FileDetail_BankAccount.WOrdPartyName, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //69  Ordering party ID                                   15        1459    AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #WIRE_MTS  ||
           mSKS_EFT_FileFormatPaymSpec.TransactionCode == #WIRE_IWI)
        {
            sb.Append(SKS_PP_StringFormats::strFill(15, mSKS_EFT_FileDetail.BankBankAcct, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //70  Ordering party address1                              55*      1474    AN
        sb.Append(SKS_PP_StringFormats::strFill(55, subStr(mSKS_EFT_FileDetail_BankAccount.WOrdPartyAddr, 1, 35), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //71  Ordering party address2                              55*      1529    AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #WIRE_MTS ||
           mSKS_EFT_FileFormatPaymSpec.TransactionCode == #WIRE_IWI)
        {
            sb.Append(SKS_PP_StringFormats::strFill(55, subStr(mSKS_EFT_FileDetail_BankAccount.WOrdPartyAddr2, 1, 35), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //72  Ordering party city                                   30*     1584    AN
        switch(mSKS_EFT_FileFormatPaymSpec.TransactionCode)
        {
            case #WIRE_MTS:
            case #WIRE_IWI:
                len = 25;
                break;
            default:
                len = 30;
                break;
        }
        sb.Append(SKS_PP_StringFormats::strFill(30, subStr(mSKS_EFT_FileDetail_BankAccount.WOrdPartyCity, 1, len), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //73  Ordering party state / province                       3       1614    AN
        sb.Append(SKS_PP_StringFormats::strFill(3, mSKS_EFT_FileDetail_BankAccount.WOrdPartyState, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //74  Ordering party postal code                            9       1617    AN
        sb.Append(SKS_PP_StringFormats::strFill(9, mSKS_EFT_FileDetail_BankAccount.WOrdPartyZipCode, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //75  Ordering party country code                           2       1626    AN
        sb.Append(SKS_PP_StringFormats::strFill(2, this.getLogisticsAddressCountryISO(mSKS_EFT_FileDetail_BankAccount.WOrdPartyCountryRegionId), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //76  Ordering party country name                           30      1628    AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //77  Originating party to receiving party information / charge description            140*     1658    AN
        sb.Append(SKS_PP_StringFormats::strFill(140, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //78  Bank to bank information                              210     1798    AN
        sb.Append(SKS_PP_StringFormats::strFill(210, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //79  ACH format code/  check delivery instruction/ CEO wire type code/POB Type         4       2008    AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #ACHCCD)
        {
            sb.Append(SKS_PP_StringFormats::strFill(4, 'CCD', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(4, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        //80  ACH international type code                           3       2012    AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //81  ACH company ID                                        10      2015    AN
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #ACHCCD)
        {
            sb.Append(SKS_PP_StringFormats::strFill(10, mSKS_EFT_FileDetail.FileACHCompanyId, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //82  Check number                                          15*     2025    AN
        sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //83  Document template number                              10      2040    AN
        sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //84  EDD biller ID                                         60      2050    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //85  File format                                           5       2110    AN
        sb.Append(SKS_PP_StringFormats::strFill(5, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //86  Delivery type                                         5       2115    AN
        sb.Append(SKS_PP_StringFormats::strFill(5, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //87  Delivery contact name                                 60      2120    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //88  Delivery fax number                                   12      2180    AN
        sb.Append(SKS_PP_StringFormats::strFill(12, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //89  Delivery email address                                60      2192    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //90  Delivery user ID                                      60      2252    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //91  Delivery company ID                                   60      2312    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //92  Secure type                                           6       2372    AN
        sb.Append(SKS_PP_StringFormats::strFill(6, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //93  Secure question 1                                     255     2378    AN
        sb.Append(SKS_PP_StringFormats::strFill(255, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //94  Secure password 1                                     60      2633    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //95  Secure question 2                                     255     2693    AN
        sb.Append(SKS_PP_StringFormats::strFill(255, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //96  Secure password 2                                     60      2948    AN
        sb.Append(SKS_PP_StringFormats::strFill(60, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //97  EDD handling code                                     1       3008    AN
        sb.Append(SKS_PP_StringFormats::strFill(1, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //98  CEO template ID                                       16      3009    AN
        sb.Append(SKS_PP_StringFormats::strFill(16, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //99  Batch ID                                              10      3025    AN*
        sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //100  Operator ID                                          10      3035    AN
        sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //101  CEO company ID                                       10      3045    AN
        sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //102  Reserved                                             2       3055    AN
        sb.Append(SKS_PP_StringFormats::strFill(2, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //103  PDP handling code                                    1       3057    AN
        sb.Append(SKS_PP_StringFormats::strFill(1, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //104  EDD receiving address 1                              55      3058    AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //105  EDD receiving address 2                              55      3113    AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //106  EDD receiving city                                   55      3168    AN
        sb.Append(SKS_PP_StringFormats::strFill(55, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //107  EDD receiving state                                  3       3223    AN
        sb.Append(SKS_PP_StringFormats::strFill(3, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //108  EDD receiving zip                                    9       3226    AN
        sb.Append(SKS_PP_StringFormats::strFill(9, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //109  EDD receiving country                                30      3235    AN
        sb.Append(SKS_PP_StringFormats::strFill(30, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //110  FX Type                                              2       3265    AN
        sb.Append(SKS_PP_StringFormats::strFill(2, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        this.fileWrite(sb.ToString());
    }

]]></Source>
			</Method>
			<Method>
				<Name>rec_Invoice</Name>
				<Source><![CDATA[
    //Nbr   Description                                         Max     Start   Type
    //1     Record ID                                           1       1       AN
    //2     Invoice number                                      15*     2       AN
    //3     Invoice date                                        10      17      DT
    //4     Invoice description                                 80*     27      AN
    //5     Invoice (payment) net amount                        15      107     N
    //6     Invoice gross amount                                15      122     N
    //7     Discount taken                                      15      137     N
    //8     Related PO number/Linkage ID                        15      152     AN*
    //9     Reserved                                            2       167     AN
    //10    Invoice type                                        3       169     AN

    void rec_Invoice(SKS_EFT_FileDetail invSKS_EFT_FileDetail)
    {
        //BP Deviation Documented
        System.Text.StringBuilder sb = new System.Text.StringBuilder();
        AmountCur grossAmt;
        ;
        //1     Record ID                                           1       1       AN
        sb.Append('I');

        //2     Invoice number                                      15*     2       AN
        sb.Append(SKS_PP_StringFormats::strFill(15, invSKS_EFT_FileDetail.InvoiceNumber, SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //3     Invoice date                                        10      17      DT
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #ACHCCD)
        {
            sb.Append(SKS_PP_StringFormats::strFill(10,SKS_PP_StringFormats::strDateYYYYMMDD(invSKS_EFT_FileDetail.InvoiceDate, DateSeparator::Hyphen), SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(10, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
        }

        //4     Invoice description                                 80*     27      AN
        sb.Append(SKS_PP_StringFormats::strFill(80, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //5     Invoice (payment) net amount                        15      107     N
        //6     Invoice gross amount                                15      122     N
        //7     Discount taken                                      15      137     N
        if(mSKS_EFT_FileFormatPaymSpec.TransactionCode == #ACHCCD)
        {
            sb.Append(SKS_PP_StringFormats::strFill(15, num2str(-1 * invSKS_EFT_FileDetail.InvoiceSettleAmountPmtCur,0,2,1,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
            
            grossAmt = invSKS_EFT_FileDetail.InvoiceSettleAmountPmtCur + invSKS_EFT_FileDetail.InvoiceDiscAmountPmtCur;
            sb.Append(SKS_PP_StringFormats::strFill(15, num2str(-1 * grossAmt,0,2,1,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));

            sb.Append(SKS_PP_StringFormats::strFill(15, num2str(-1 * invSKS_EFT_FileDetail.InvoiceDiscAmountPmtCur,0,2,1,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
        }
        else
        {
            sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
            sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
            sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
        }       

        //8  Related PO number/Linkage ID                        15      152     AN*
        sb.Append(SKS_PP_StringFormats::strFill(15, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //9  Reserved                                            2       167     AN
        sb.Append(SKS_PP_StringFormats::strFill(2, '', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));

        //10  Invoice type                                        3       169     AN
        sb.Append(SKS_PP_StringFormats::strFill(3, 'IV', SKS_PP_FillCharacter::Space, SKS_PP_FillSide::Right));
                
        //11  End of record                                       2       172     AN
        sb.Append('II');

        this.fileWrite(sb.ToString());
    }

]]></Source>
			</Method>
			<Method>
				<Name>rec_Trailer</Name>
				<Source><![CDATA[
    //Nbr   Description                                         Max     Start   Type
    //1     Record ID                                           1       1       AN
    //2     Payment count                                       8       2       N
    //3     Payment amount                                      15      10      N
    //4     End of record                                       2       25      AN
    
    void rec_Trailer()
    {
        //BP Deviation Documented
        System.Text.StringBuilder sb = new System.Text.StringBuilder();
        ;
    
        //1     Record ID                                           1       1       AN
        sb.Append('T');
    
        //2     Payment count                                       8       2       N
        sb.Append(SKS_PP_StringFormats::strFill(8, num2str(mPaymentCount,0,0,0,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
    
        //3     Payment amount                                      15      10      N
        sb.Append(SKS_PP_StringFormats::strFill(15, num2str(mPaymentAmount,0,2,0,0), SKS_PP_FillCharacter::Zero, SKS_PP_FillSide::Left));
    
        //4     End of record                                       2       25      AN
        sb.Append('TT');
        this.fileWrite(sb.ToString());
    }

]]></Source>
			</Method>
			<Method>
				<Name>selectPaymentRecords</Name>
				<Source><![CDATA[
    protected void selectPaymentRecords()
    {
        //------------------------------------------------------------------------------------------------------
        // Standard payment selction
        // Override if different selection is need for a format
        //------------------------------------------------------------------------------------------------------
    
        //Order by clause must match the clause in the SKS_EFT_Processing.SumByPayment
        select * from mSKS_EFT_FileDetail
            join mSKS_EFT_FileDetail_BenBank
            join mSKS_EFT_FileDetail_VendAddress
            join mSKS_EFT_FileDetail_BankAccount
              order by mSKS_EFT_FileDetail.RecordSection,
                   mSKS_EFT_FileDetail.PaymMode,
                   mSKS_EFT_FileDetail.BankAccountId,
                   mSKS_EFT_FileDetail.PaymentCurrencyCode,
                   mSKS_EFT_FileDetail.PaymSpec,
                   mSKS_EFT_FileDetail.EffectiveDate,
                   mSKS_EFT_FileDetail.DepCountryRegionId,
                   mSKS_EFT_FileDetail.RecordType,
                   mSKS_EFT_FileDetail.AccountNum,
                   mSKS_EFT_FileDetail.PaymentReference,
                   mSKS_EFT_FileDetail.RecId
          where mSKS_EFT_FileDetail.FileRecId == mSKS_EFT_File.RecId &&
                mSKS_EFT_FileDetail.RecordSection == SKS_EFT_RecordSection::Payments &&
                mSKS_EFT_FileDetail.RecordSummary != SKS_EFT_RecordSummary::NonSummary &&
                mSKS_EFT_FileDetail.RecId == mSKS_EFT_FileDetail_VendAddress.RefRecId &&
                mSKS_EFT_FileDetail.RecId == mSKS_EFT_FileDetail_BenBank.RefRecId &&
                mSKS_EFT_FileDetail.RecId == mSKS_EFT_FileDetail_BankAccount.RefRecId;
    }

]]></Source>
			</Method>
		</Methods>
	</SourceCode>
</AxClass>